<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><title>Bash Libraries :: A collection of Bash libraries</title><meta name=description content="A collection of Bash libraries"><meta name=author content="Oleksii Tsvietnov"><meta name=keywords content=bash,shell,library,bash-library,shell-library><meta name=robots content=index,follow><meta name=viewport content="width=device-width, initial-scale=1.0"><!--[if lt IE 9]>
    <script src="https://bash.libs.cf/theme/html5.js?v=1497518371"></script>
    <![endif]--><link rel=stylesheet href="https://bash.libs.cf/theme/bootstrap-pygments.bundle.min.css?v=1497518371"><link rel="shortcut icon" href="/favicon.ico?v=1497518371"><meta name=apple-mobile-web-app-title content="Bash Libraries"><meta name=application-name content="Bash Libraries"></head> <body> <div class=navbar> <div class=navbar-inner> <div class=container> <a href=https://bash.libs.cf/ class=brand>Bash Libraries</a> <a class="btn btn-navbar" data-toggle=collapse data-target=.nav-collapse> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </a> <div class=nav-collapse> <ul class="nav pull-right"> <!-- <li class="divider-vertical"></li> --> <li><a href=https://github.com/vorakl/bash-libs>repo</a></li> <li><a href=https://vorakl.name/ >blog</a></li> <li><a href=https://vorakl.name/pages/about/ >author</a></li> <!-- <li class="divider-vertical"></li> --> <li><a href=https://bash.libs.cf/pages/common/ >common</a></li> <li><a href=https://bash.libs.cf/pages/info/ >info</a></li> </ul> </div> </div> </div> </div> <div class=container> <div class=content> <div class=row> <div class=span9> <div class=article> <div class=content-title> <h1>A collection of Bash libraries</h1> <h3>A collection of Bash libraries</h3> </div> <div><p><a class="reference external" href=https://travis-ci.org/vorakl/bash-libs><img alt="Travis CI: continuous integration status" src="https://travis-ci.org/vorakl/bash-libs.svg?branch=master"></a></p> <ul class=simple> <li><a class="reference internal" href=#introduction>Introduction</a></li> <li><a class="reference internal" href=#the-list-of-libraries>The list of libraries</a></li> <li><dl class="first docutils"> <dt><a class="reference internal" href=#installation>Installation</a></dt> <dd><ul class="first last"> <li><a class="reference internal" href=#the-simplest-one-liner-which-uses-curl-wget-to-dowload-a-file-without-saving-on-a-disk>The simplest one-liner which uses curl/wget to dowload a file without saving on a disk</a></li> <li><a class="reference internal" href=#download-a-library-by-curl-and-check-an-integrity-by-sha256sum>Download a library by curl and check an integrity by sha256sum</a></li> <li><a class="reference internal" href=#download-a-library-using-a-pure-bash-without-saving-on-a-disk>Download a library using a pure Bash without saving on a disk</a></li> </ul> </dd> </dl> </li> <li><a class="reference internal" href=#how-to-reconfigure-the-functions>How to reconfigure the functions</a></li> </ul> <div class=section id=introduction> <h2>Introduction</h2> <p>Bash is a powerful programming language and very useful for operational tasks. Without any doubts, this is the first &quot;tool&quot; you use in system administering of Unix-like operating systems. Unfortunately, it doesn't have a &quot;Standard library&quot; with all that functions which make a development process easier, faster and more efficient in all senses.</p> <p>Suddenly, I realized that I use the same functions, same blocks of code everywhere. Apparently, copy-pasting them from one script to another is not a right approach. That's why I decided to organize the most used functions in a few libraries and place them on a publicly available resource over http. This makes possible to find all needed files in one place, download them using simple tools or even a pure Bash code, always download the latest version of each library or even get stuck to a specific version in terms of stability and reliability.</p> <p>Basically, for me use these functions helps to</p> <ul class=simple> <li>reuse the same code everywhere which is checked and proved by the time</li> <li>simplify and speed up a development</li> <li>increase a readability of code</li> </ul> <p>Besides all mentioned benefits, I would recommend to spend a little time and dig into the code to get a full understanding of how it works. Actually, this is a good practice before using any kind of libraries or functions.</p> </div> <div class=section id=the-list-of-libraries> <h2>The list of libraries</h2> <ul class=simple> <li><a href=/pages/common/ class="reference external">common</a>, the library with often used functions</li> </ul> </div> <div class=section id=installation> <h2>Installation</h2> <p>In general, the installation process looks as follows:</p> <ol class=arabic> <li><dl class="first docutils"> <dt>Download the latest version of a library from this collection.</dt> <dd><p class=first>The URL to a library's file should be constructed from three parts by gluing them together:</p> <ul class=simple> <li><strong>The base URL</strong>. It is <tt class="docutils literal"><span class=pre>http://bash.libs.cf/files/</span></tt></li> <li><strong>The version</strong>. The list of all available versions is <a class="reference external" href=https://github.com/vorakl/bash-libs/releases>here</a>. This is optional and if it's not specified, then the latest version will be requested. Basically, it follows the <a href=http://semver.org/ class="reference external">Semantic Versioning</a>, e.g. v1.2.3</li> <li><strong>The name of a library</strong>. It's exactly the same name as in <a class="reference internal" href=#the-list-of-libraries>The list of libraries</a></li> </ul> <p>For example:</p> <ul class=simple> <li><tt class="docutils literal"><span class=pre>http://bash.libs.cf/files/common</span></tt>, for the <tt class="docutils literal">common</tt> library and the latest version.</li> <li><tt class="docutils literal"><span class=pre>http://bash.libs.cf/files/v1.0.4/common</span></tt>, for the <tt class="docutils literal">common</tt> library and the v1.0.4 version.</li> </ul> <p>In addition, each library comes with a sha256 hash. A file name for it looks like ${LIBNAME}.sha256 For example, these are URLs for a sha256 hashes of the <tt class="docutils literal">common</tt> library:</p> <ul class="last simple"> <li><tt class="docutils literal"><span class=pre>http://bash.libs.cf/files/common.sha256</span></tt></li> <li><tt class="docutils literal"><span class=pre>http://bash.libs.cf/files/v1.0.4/common.sha256</span></tt></li> </ul> </dd> </dl> </li> <li><dl class="first docutils"> <dt>Include it into your script.</dt> <dd><p class="first last">Usually, external files with Bash code are included by <tt class="docutils literal">source /path/to/file</tt> or <tt class="docutils literal">. /path/to/file</tt> instuctions.</p> </dd> </dl> </li> </ol> <p>There are plenty of ways to do these two steps. I'm gonna show just a few examples of how to download and include a library to some bash script.</p> <div class=section id=the-simplest-one-liner-which-uses-curl-wget-to-dowload-a-file-without-saving-on-a-disk> <h3>The simplest one-liner which uses curl/wget to dowload a file without saving on a disk</h3> <p>This code downloads the <tt class="docutils literal">common</tt> library from the remote resource on each run and doesn't save it in any file. Usually, this snippet needs to be added some where in the begining of a bash script.</p> <div class=highlight><pre><span></span><span class=nv>lib_name</span><span class=o>=</span><span class=s2>&quot;common&quot;</span><span class=p>;</span> <span class=nb>source</span> &lt;<span class=o>(</span>curl -sSLf http://bash.libs.cf/files/<span class=si>${</span><span class=nv>lib_name</span><span class=si>}</span><span class=o>)</span>
</pre></div> <p>or</p> <div class=highlight><pre><span></span><span class=nv>lib_name</span><span class=o>=</span><span class=s2>&quot;v1.0.4/common&quot;</span><span class=p>;</span> . &lt;<span class=o>(</span>wget -qO - http://bash.libs.cf/files/<span class=si>${</span><span class=nv>lib_name</span><span class=si>}</span><span class=o>)</span>
</pre></div> <p>For instance, it can be used as follows:</p> <div class=highlight><pre><span></span><span class=ch>#!/bin/bash</span>

main<span class=o>()</span> <span class=o>{</span>
    <span class=nv>lib_name</span><span class=o>=</span><span class=s2>&quot;common&quot;</span>
    <span class=nb>source</span> &lt;<span class=o>(</span>curl -sSLf http://bash.libs.cf/files/<span class=si>${</span><span class=nv>lib_name</span><span class=si>}</span><span class=o>)</span>

    <span class=c1># add your code here</span>
<span class=o>}</span>

main <span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span>
</pre></div> </div> <div class=section id=download-a-library-by-curl-and-check-an-integrity-by-sha256sum> <h3>Download a library by curl and check an integrity by sha256sum</h3> <p>This snippet uses two external commands (<tt class="docutils literal">curl</tt> and <tt class="docutils literal">sha256sum</tt>) to download a library (a version can be also specified), checks its sha256 hash and keeps everything in memory, without saving files on a disk. If everything is fine, then the library is included. Otherwise, the script exits with an error message. To simplify things, it's represented as a separate function <tt class="docutils literal">import_lib</tt>:</p> <div class=highlight><pre><span></span><span class=c1># usage: import_lib lib_name [version]</span>
import_lib<span class=o>()</span> <span class=o>{</span>
    <span class=nb>local</span> _lib_name _ver _lib_content _lib_hash _origlib_hash

    <span class=nv>_lib_name</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>?The lib name is empty</span><span class=si>}</span><span class=s2>&quot;</span>
    <span class=o>[[</span> -n <span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>_ver</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>/&quot;</span> <span class=o>||</span> <span class=nv>_ver</span><span class=o>=</span><span class=s2>&quot;&quot;</span>
    <span class=nv>_lib_content</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>curl -sSLf http://bash.libs.cf/files/<span class=si>${</span><span class=nv>_ver</span><span class=si>}${</span><span class=nv>_lib_name</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span>
    <span class=nv>_lib_hash</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span><span class=nb>set</span> -- <span class=k>$(</span>sha256sum &lt;<span class=o>(</span><span class=nb>echo</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_lib_content</span><span class=si>}</span><span class=s2>&quot;</span><span class=k>)</span> <span class=k>)</span><span class=s2>; echo &quot;</span><span class=nv>$1</span><span class=s2>&quot;)&quot;</span>
    <span class=nv>_origlib_hash</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span><span class=nb>set</span> -- <span class=k>$(</span>curl -sSLf http://bash.libs.cf/files/<span class=si>${</span><span class=nv>_ver</span><span class=si>}${</span><span class=nv>_lib_name</span><span class=si>}</span>.sha256<span class=k>)</span><span class=p>;</span> <span class=nb>echo</span> <span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_lib_hash</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>==</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_origlib_hash</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>source</span> &lt;<span class=o>(</span><span class=nb>echo</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_lib_content</span><span class=si>}</span><span class=s2>&quot;</span><span class=o>)</span>
    <span class=k>else</span>
        <span class=nb>echo</span> <span class=s2>&quot;The &#39;</span><span class=si>${</span><span class=nv>_ver</span><span class=si>}${</span><span class=nv>_lib_name</span><span class=si>}</span><span class=s2>&#39; library hasn&#39;t been loaded&quot;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
        <span class=nb>exit</span> <span class=m>1</span>
    <span class=k>fi</span>
<span class=o>}</span>
</pre></div> <p>This is how it can be used:</p> <div class=highlight><pre><span></span><span class=ch>#!/bin/bash</span>

main<span class=o>()</span> <span class=o>{</span>
    import_lib common
    <span class=c1># import_lib common v1.0.4</span>

    <span class=c1># add your code here</span>
<span class=o>}</span>

import_lib<span class=o>()</span> <span class=o>{</span>
    <span class=nb>local</span> _lib_name _ver _lib_content _lib_hash _origlib_hash

    <span class=nv>_lib_name</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>1</span><span class=p>?The lib name is empty</span><span class=si>}</span><span class=s2>&quot;</span>
    <span class=o>[[</span> -n <span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>&quot;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>_ver</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$2</span><span class=s2>/&quot;</span> <span class=o>||</span> <span class=nv>_ver</span><span class=o>=</span><span class=s2>&quot;&quot;</span>
    <span class=nv>_lib_content</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>curl -sSLf http://bash.libs.cf/files/<span class=si>${</span><span class=nv>_ver</span><span class=si>}${</span><span class=nv>_lib_name</span><span class=si>}</span><span class=k>)</span><span class=s2>&quot;</span>
    <span class=nv>_lib_hash</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span><span class=nb>set</span> -- <span class=k>$(</span>sha256sum &lt;<span class=o>(</span><span class=nb>echo</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_lib_content</span><span class=si>}</span><span class=s2>&quot;</span><span class=k>)</span> <span class=k>)</span><span class=s2>; echo &quot;</span><span class=nv>$1</span><span class=s2>&quot;)&quot;</span>
    <span class=nv>_origlib_hash</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span><span class=nb>set</span> -- <span class=k>$(</span>curl -sSLf http://bash.libs.cf/files/<span class=si>${</span><span class=nv>_ver</span><span class=si>}${</span><span class=nv>_lib_name</span><span class=si>}</span>.sha256<span class=k>)</span><span class=p>;</span> <span class=nb>echo</span> <span class=s2>&quot;</span><span class=nv>$1</span><span class=s2>&quot;</span><span class=k>)</span><span class=s2>&quot;</span>
    <span class=k>if</span> <span class=o>[[</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_lib_hash</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>==</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_origlib_hash</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
        <span class=nb>source</span> &lt;<span class=o>(</span><span class=nb>echo</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>_lib_content</span><span class=si>}</span><span class=s2>&quot;</span><span class=o>)</span>
    <span class=k>else</span>
        <span class=nb>echo</span> <span class=s2>&quot;The &#39;</span><span class=si>${</span><span class=nv>_ver</span><span class=si>}${</span><span class=nv>_lib_name</span><span class=si>}</span><span class=s2>&#39; library hasn&#39;t been loaded&quot;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
        <span class=nb>exit</span> <span class=m>1</span>
    <span class=k>fi</span>
<span class=o>}</span>

main <span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span>
</pre></div> </div> <div class=section id=download-a-library-using-a-pure-bash-without-saving-on-a-disk> <h3>Download a library using a pure Bash without saving on a disk</h3> <p>This one is quite interesting. For downloading a library it doesn't use any external commands like <tt class="docutils literal">curl</tt> or <tt class="docutils literal">wget</tt>, just a pure Bash code. It also doesn't store a file on a disk.</p> <div class=highlight><pre><span></span><span class=nv>lib_name</span><span class=o>=</span><span class=s2>&quot;v1.0.4/common&quot;</span>
<span class=nb>source</span> &lt;<span class=o>(</span>
    <span class=nb>exec</span> <span class=m>3</span>&lt;&gt;/dev/tcp/bash.libs.cf/80
    <span class=nb>printf</span> <span class=s2>&quot;GET /files/</span><span class=si>${</span><span class=nv>lib_name</span><span class=si>}</span><span class=s2> HTTP/1.1\nHost: bash.libs.cf\nConnection: close\n\n&quot;</span> &gt;<span class=p>&amp;</span><span class=m>3</span>
    <span class=nv>body</span><span class=o>=</span><span class=m>0</span><span class=p>;</span>
    <span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span> <span class=nb>read</span> -u <span class=m>3</span> -r str<span class=p>;</span> <span class=k>do</span>
        <span class=k>if</span> <span class=o>((</span> body <span class=o>))</span><span class=p>;</span> <span class=k>then</span>
            <span class=nb>printf</span> <span class=s2>&quot;%s\n&quot;</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=si>}</span><span class=s2>&quot;</span>
        <span class=k>else</span>
            <span class=o>[[</span> -z <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=p>%</span><span class=s1>$&#39;\r&#39;</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>body</span><span class=o>=</span><span class=m>1</span>
        <span class=k>fi</span>
    <span class=k>done</span>
    <span class=nb>exec</span> <span class=m>3</span>&gt;<span class=p>&amp;</span>-
<span class=o>)</span>
</pre></div> <p>or in a shorter form, as a one-liner</p> <div class=highlight><pre><span></span><span class=nv>lib_name</span><span class=o>=</span><span class=s2>&quot;common&quot;</span><span class=p>;</span> <span class=nb>source</span> &lt;<span class=o>(</span><span class=nb>exec</span> <span class=m>3</span>&lt;&gt;/dev/tcp/bash.libs.cf/80<span class=p>;</span> <span class=nb>printf</span> <span class=s2>&quot;GET /files/</span><span class=si>${</span><span class=nv>lib_name</span><span class=si>}</span><span class=s2> HTTP/1.1\nHost: bash.libs.cf\nConnection: close\n\n&quot;</span> &gt;<span class=p>&amp;</span><span class=m>3</span><span class=p>;</span> <span class=nv>body</span><span class=o>=</span><span class=m>0</span><span class=p>;</span> <span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span> <span class=nb>read</span> -u <span class=m>3</span> -r str<span class=p>;</span> <span class=k>do</span> <span class=k>if</span> <span class=o>((</span> body <span class=o>))</span><span class=p>;</span> <span class=k>then</span> <span class=nb>printf</span> <span class=s2>&quot;%s\n&quot;</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>;</span> <span class=k>else</span> <span class=o>[[</span> -z <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=p>%</span><span class=s1>$&#39;\r&#39;</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>body</span><span class=o>=</span><span class=m>1</span><span class=p>;</span> <span class=k>fi</span> <span class=k>done</span><span class=p>;</span> <span class=nb>exec</span> <span class=m>3</span>&gt;<span class=p>&amp;</span>-<span class=o>)</span>
</pre></div> <p>This is the example of how the snippet can be used. In addition, it shows how to configure a behaviour of functions from the library by defining <tt class="docutils literal">__common_init__()</tt> function, how to do a formated printing and how to run a command under the wrapper for controling an exit status and save stdout/stderr separately in variables.</p> <div class=highlight><pre><span></span><span class=ch>#!/bin/bash</span>

main<span class=o>()</span> <span class=o>{</span>
    <span class=nv>lib_name</span><span class=o>=</span><span class=s2>&quot;common&quot;</span>
    <span class=nb>source</span> &lt;<span class=o>(</span><span class=nb>exec</span> <span class=m>3</span>&lt;&gt;/dev/tcp/bash.libs.cf/80<span class=p>;</span> <span class=nb>printf</span> <span class=s2>&quot;GET /files/</span><span class=si>${</span><span class=nv>lib_name</span><span class=si>}</span><span class=s2> HTTP/1.1\nHost: bash.libs.cf\nConnection: close\n\n&quot;</span> &gt;<span class=p>&amp;</span><span class=m>3</span><span class=p>;</span> <span class=nv>body</span><span class=o>=</span><span class=m>0</span><span class=p>;</span> <span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span> <span class=nb>read</span> -u <span class=m>3</span> -r str<span class=p>;</span> <span class=k>do</span> <span class=k>if</span> <span class=o>((</span> body <span class=o>))</span><span class=p>;</span> <span class=k>then</span> <span class=nb>printf</span> <span class=s2>&quot;%s\n&quot;</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>;</span> <span class=k>else</span> <span class=o>[[</span> -z <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=p>%</span><span class=s1>$&#39;\r&#39;</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>body</span><span class=o>=</span><span class=m>1</span><span class=p>;</span> <span class=k>fi</span> <span class=k>done</span><span class=p>;</span> <span class=nb>exec</span> <span class=m>3</span>&gt;<span class=p>&amp;</span>-<span class=o>)</span>

    say <span class=s2>&quot;Usage:   </span><span class=nv>$0</span><span class=s2> command arg ...&quot;</span>
    say <span class=s2>&quot;Example: </span><span class=nv>$0</span><span class=s2> ls -l /&quot;</span>
    say <span class=s2>&quot;         </span><span class=nv>$0</span><span class=s2> ls -l /nonexistent&quot;</span>
    say <span class=s2>&quot;\nI&#39;m about to run &#39;</span><span class=nv>$*</span><span class=s2>&#39;&quot;</span>

    run --warn --save-out output --save-err errors <span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span>

    say <span class=s2>&quot;\nStdOut:&quot;</span>
    say <span class=s2>&quot;</span><span class=si>${</span><span class=nv>output</span><span class=si>}</span><span class=s2>&quot;</span>

    say <span class=s2>&quot;\nStdErr:&quot;</span>
    say <span class=s2>&quot;</span><span class=si>${</span><span class=nv>errors</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=o>}</span>

__common_init__<span class=o>()</span> <span class=o>{</span>
    <span class=nv>SAY_FORMAT</span><span class=o>=</span><span class=s2>&quot;%b\n&quot;</span>
<span class=o>}</span>

main <span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span>
</pre></div> </div> </div> <div class=section id=how-to-reconfigure-the-functions> <h2>How to reconfigure the functions</h2> <p>Many functions in libraries can be reconfigured at run-time by setting appropriate parameters. All available for changing parameters can be found in the description to a function. This allows to use the same code everywhere and change a function's behavior (e.g. messages format, exit codes) for a particular need. It's possible to do either at global scope by setting them once in the beginning of a script (<a class="reference external" href=https://github.com/vorakl/bash-libs/blob/master/examples/common/say-err-debug.sh>example1</a>) or in-line to modify a specific call (<a class="reference external" href=https://github.com/vorakl/bash-libs/blob/master/examples/common/run-output.sh>example2</a>).</p> <p>It works as follows. Every library has an entrypoint, a function which is called like <tt class="docutils literal"><span class=pre>__${LIB}_main__</span></tt>. It's executed automaticaly when a library is included. In the next step, <tt class="docutils literal"><span class=pre>__${LIB}_conf__</span></tt> is executed which runs all available <tt class="docutils literal"><span class=pre>__${FUNC}_conf__</span></tt> functions for for setting default values. Then, <tt class="docutils literal"><span class=pre>__${LIB}_main__</span></tt> checks if the <tt class="docutils literal"><span class=pre>__${LIB}_init__</span></tt> function has been previosly defined (in a script which includes a library). If so, it's also executed. This is exactly the function where all needed parameters should be redefined. In the last step, the <tt class="docutils literal"><span class=pre>__${LIB}_export__</span></tt> function is executed to export all functions which are mentioned in the <tt class="docutils literal"><span class=pre>__${LIB}_export</span></tt> variable. This variable, actually, can be also redefined in the <tt class="docutils literal"><span class=pre>__${LIB}_init__</span></tt> function. By changing the <tt class="docutils literal"><span class=pre>__${LIB}_export</span></tt> variable, you can controll which functions will be available only in the script and which in all sub-processes.</p> <div class=highlight><pre><span></span><span class=ch>#!/bin/bash</span>

main<span class=o>()</span> <span class=o>{</span>
    <span class=nv>lib_name</span><span class=o>=</span><span class=s2>&quot;common&quot;</span>
    <span class=nb>source</span> &lt;<span class=o>(</span><span class=nb>exec</span> <span class=m>3</span>&lt;&gt;/dev/tcp/bash.libs.cf/80<span class=p>;</span> <span class=nb>printf</span> <span class=s2>&quot;GET /files/</span><span class=si>${</span><span class=nv>lib_name</span><span class=si>}</span><span class=s2> HTTP/1.1\nHost: bash.libs.cf\nConnection: close\n\n&quot;</span> &gt;<span class=p>&amp;</span><span class=m>3</span><span class=p>;</span> <span class=nv>body</span><span class=o>=</span><span class=m>0</span><span class=p>;</span> <span class=k>while</span> <span class=nv>IFS</span><span class=o>=</span> <span class=nb>read</span> -u <span class=m>3</span> -r str<span class=p>;</span> <span class=k>do</span> <span class=k>if</span> <span class=o>((</span> body <span class=o>))</span><span class=p>;</span> <span class=k>then</span> <span class=nb>printf</span> <span class=s2>&quot;%s\n&quot;</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>;</span> <span class=k>else</span> <span class=o>[[</span> -z <span class=s2>&quot;</span><span class=si>${</span><span class=nv>str</span><span class=p>%</span><span class=s1>$&#39;\r&#39;</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>body</span><span class=o>=</span><span class=m>1</span><span class=p>;</span> <span class=k>fi</span> <span class=k>done</span><span class=p>;</span> <span class=nb>exec</span> <span class=m>3</span>&gt;<span class=p>&amp;</span>-<span class=o>)</span>

    say <span class=s2>&quot;The &#39;say&#39; function works in this script...&quot;</span>
    bash -c say <span class=s2>&quot;... and doesn&#39;t work in a sub-processes because it wasn&#39;t exported&quot;</span>
<span class=o>}</span>

__common_init__<span class=o>()</span> <span class=o>{</span>
    <span class=nv>__common_export</span><span class=o>=</span><span class=s2>&quot;cmd run&quot;</span>
<span class=o>}</span>

main <span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span>
</pre></div> <!-- Links --> </div> </div> </div> </div> <div class=span3> <div class=well style="padding: 8px 0; background-color: #FBFBFB;"> <ul class="nav nav-list"> <li class=nav-header> MENU </li> <li><a href=https://github.com/vorakl/bash-libs>repo</a></li> <li><a href=https://vorakl.name/ >blog</a></li> <li><a href=https://vorakl.name/pages/about/ >author</a></li> </ul> </div> <div class=well style="padding: 8px 0; background-color: #FBFBFB;"> <ul class="nav nav-list"> <li class=nav-header> LINKS </li> <li><a href=/pages/common/ >common</a></li> </ul> </div> </div> </div> </div> <footer> <p class=p-footer> <span class=pull-left> &copy; 2019 <a href=https://vorakl.name/pages/about/ >Oleksii Tsvietnov</a> All Rights Reserved </span> <span class=pull-right> Powered by <a href=https://github.com/getpelican/pelican>Pelican</a> and <a href=https://aves.cf/ >Aves</a> theme </span> </p> </footer> </div> <script src="https://bash.libs.cf/theme/jquery-bootstrap-collapse.bundle.min.js?v=1497518371"></script> </body> </html>